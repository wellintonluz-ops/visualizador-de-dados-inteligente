<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Dados Inteligente</title>
    <!-- Tailwind CSS para estilização rápida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js para a criação de gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <!-- PapaParse para ler arquivos CSV no navegador -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- SheetJS (xlsx) para ler arquivos Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Lucide Icons para ícones -->
    <script src="https://unpkg.com/lucide-react@0.292.0/dist/lucide-react.js"></script>
    <style>
        /* Estilos personalizados para melhorar a aparência */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .chart-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .chart-card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="text-gray-800">

    <!-- Container principal da aplicação -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Cabeçalho -->
        <header class="bg-white shadow-md p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                <h1 class="text-2xl font-bold text-gray-700">Visualizador de Dados Dinâmico</h1>
            </div>
            <button id="reset-button" class="hidden bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M21 21v-5h-5"/></svg>
                Carregar Outro Arquivo
            </button>
        </header>

        <!-- Seção de Upload (visível inicialmente) -->
        <main id="upload-section" class="flex-grow flex items-center justify-center p-4">
            <div class="w-full max-w-2xl text-center">
                <div id="drop-zone" class="border-4 border-dashed border-gray-300 rounded-2xl p-10 md:p-20 cursor-pointer hover:border-blue-500 transition-all bg-white">
                    <input type="file" id="file-input" class="hidden" accept=".csv, .xlsx">
                    <div class="flex flex-col items-center gap-4 text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                        <h2 class="text-xl font-semibold">Arraste e solte seu arquivo CSV ou XLSX aqui</h2>
                        <p class="text-gray-500">ou</p>
                        <button id="browse-button" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                            Procure no seu computador
                        </button>
                        <p id="file-name" class="mt-2 text-sm font-medium text-gray-700"></p>
                    </div>
                </div>
                 <div id="loading-indicator" class="hidden mt-6 flex flex-col items-center justify-center gap-4">
                    <div class="loading-spinner"></div>
                    <p class="text-gray-600 font-medium">Analisando seus dados...</p>
                </div>
                <div id="error-message" class="hidden mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                    <strong class="font-bold">Erro!</strong>
                    <span class="block sm:inline" id="error-text"></span>
                </div>
            </div>
        </main>

        <!-- Seção do Dashboard (oculta inicialmente) -->
        <div id="dashboard-section" class="hidden flex-grow md:flex p-4 gap-4">
            <!-- Barra Lateral com Informações dos Dados -->
            <aside class="w-full md:w-1/4 lg:w-1/5 bg-white rounded-lg shadow-md p-4 overflow-y-auto flex-shrink-0 mb-4 md:mb-0">
                <h2 class="text-xl font-bold border-b pb-2 mb-3">Colunas do Arquivo</h2>
                <div id="column-info"></div>
            </aside>

            <!-- Área Principal com os Gráficos -->
            <main class="w-full md:w-3/4 lg:w-4/5 flex flex-col">
                <div class="mb-4">
                    <button id="add-chart-button" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-5 rounded-lg transition-colors flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        Adicionar Gráfico
                    </button>
                </div>
                <div id="charts-grid" class="flex-grow grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-6 overflow-y-auto">
                    <!-- Gráficos serão inseridos aqui dinamicamente -->
                    <div id="empty-dashboard-message" class="col-span-full flex flex-col items-center justify-center text-center text-gray-500 h-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mb-4"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                        <h3 class="text-2xl font-semibold">Seu dashboard está vazio</h3>
                        <p class="mt-2">Comece clicando em "Adicionar Gráfico" para criar sua primeira visualização.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- Referências aos Elementos do DOM ---
        const uploadSection = document.getElementById('upload-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const browseButton = document.getElementById('browse-button');
        const fileNameDisplay = document.getElementById('file-name');
        const loadingIndicator = document.getElementById('loading-indicator');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const resetButton = document.getElementById('reset-button');
        const addChartButton = document.getElementById('add-chart-button');
        const columnInfoContainer = document.getElementById('column-info');
        const chartsGrid = document.getElementById('charts-grid');
        const emptyDashboardMessage = document.getElementById('empty-dashboard-message');

        // --- Variáveis de Estado Global ---
        let rawData = [];
        let headers = [];
        let columnProfiles = {};
        let charts = []; 

        // --- Funções de Manipulação de UI ---
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            loadingIndicator.classList.add('hidden');
            dropZone.classList.remove('hidden');
        }

        function resetApp() {
            uploadSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
            resetButton.classList.add('hidden');
            fileNameDisplay.textContent = '';
            errorMessage.classList.add('hidden');
            columnInfoContainer.innerHTML = '';
            chartsGrid.innerHTML = '';
            chartsGrid.appendChild(emptyDashboardMessage);
            emptyDashboardMessage.classList.remove('hidden');
            rawData = [];
            headers = [];
            columnProfiles = {};
            charts.forEach(chart => chart.destroy());
            charts = [];
            fileInput.value = ''; 
        }

        function showDashboardUI() {
            uploadSection.classList.add('hidden');
            loadingIndicator.classList.add('hidden');
            dropZone.classList.remove('hidden');
            dashboardSection.classList.remove('hidden');
            dashboardSection.classList.add('flex');
            resetButton.classList.remove('hidden');
        }

        // --- Funções de Manipulação de Arquivos e Dados ---
        function processData(data, fields, errors) {
            if (errors && errors.length > 0) {
                showError(`Erro ao ler o arquivo: ${errors[0].message}`);
                return;
            }
            if (!fields || fields.length === 0) {
                showError('Não foi possível encontrar o cabeçalho no arquivo. Verifique se a primeira linha contém os nomes das colunas.');
                return;
            }
            rawData = data;
            headers = fields;
            analyzeData();
            setupDashboard();
        }

        function handleFile(file) {
            const fileName = file ? file.name.toLowerCase() : '';
            if (!file || (!fileName.endsWith('.csv') && !fileName.endsWith('.xlsx'))) {
                showError('Por favor, selecione um arquivo CSV ou XLSX válido.');
                return;
            }
            fileNameDisplay.textContent = `Arquivo: ${file.name}`;
            errorMessage.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            dropZone.classList.add('hidden');
            
            if (fileName.endsWith('.csv')) {
                Papa.parse(file, { header: true, skipEmptyLines: true, complete: r => processData(r.data, r.meta.fields, r.errors), error: e => showError(`Erro ao processar: ${e.message}`) });
            } else {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const workbook = XLSX.read(e.target.result, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        if (!sheetName) return processData([], [], [{ message: "O arquivo XLSX não contém planilhas." }]);
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        if (jsonData.length === 0) return processData([], [], [{ message: "A planilha está vazia." }]);
                        processData(jsonData, Object.keys(jsonData[0]), []);
                    } catch (error) { showError(`Erro ao ler o arquivo XLSX: ${error.message}`); }
                };
                reader.onerror = (error) => showError(`Erro ao ler o arquivo: ${error.toString()}`);
                reader.readAsArrayBuffer(file);
            }
        }
        
        function analyzeData() {
            columnProfiles = {};
            headers.forEach(header => {
                const values = rawData.map(row => row[header]).filter(v => v !== null && v !== undefined && v !== '');
                const profile = { name: header, totalCount: values.length, type: 'Categorical' };
                const numericValues = values.map(Number).filter(v => !isNaN(v));
                if (numericValues.length / values.length > 0.9) {
                    profile.type = 'Numeric';
                    profile.min = Math.min(...numericValues);
                    profile.max = Math.max(...numericValues);
                    profile.mean = numericValues.reduce((a, b) => a + b, 0) / numericValues.length;
                }
                profile.uniqueCount = [...new Set(values)].length;
                columnProfiles[header] = profile;
            });
        }

        function setupDashboard() {
            columnInfoContainer.innerHTML = '';
            Object.values(columnProfiles).forEach(profile => {
                const isNumeric = profile.type === 'Numeric';
                const card = document.createElement('div');
                card.className = 'p-3 mb-3 border rounded-lg bg-gray-50';
                card.innerHTML = `
                    <h3 class="font-bold text-md ${isNumeric ? 'text-blue-700' : 'text-green-700'} flex items-center gap-2">
                        ${isNumeric ? '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 10V4a2 2 0 0 1 2-2h8.5L20 7.5V20a2 2 0 0 1-2 2H4"/><polyline points="14 2 14 8 20 8"/><path d="M10 18.5a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5Z"/><path d="M14 18.5a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5Z"/><path d="M6 18.5a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5Z"/></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 4h3a2 2 0 0 1 2 2v2"/><path d="M4 13v3a2 2 0 0 0 2 2h2"/><path d="M20 13v-3a2 2 0 0 0-2-2h-2"/><path d="M11 4h-3a2 2 0 0 0-2 2v2"/><path d="M18 10h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2"/><path d="M12 10V9a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v1"/><path d="M11 16v-1a1 1 0 0 0-1-1H8"/><rect width="6" height="6" x="4" y="4" rx="1"/></svg>'}
                        ${profile.name}
                    </h3>
                    <p class="text-sm text-gray-600"><strong>Tipo:</strong> ${profile.type}</p>
                    <p class="text-sm text-gray-600"><strong>Valores Únicos:</strong> ${profile.uniqueCount}</p>
                    ${isNumeric ? `<p class="text-sm text-gray-600"><strong>Média:</strong> ${profile.mean.toFixed(2)}</p>` : ''}
                `;
                columnInfoContainer.appendChild(card);
            });
            showDashboardUI();
        }

        // --- Funções de Geração de Gráficos ---

        function createChartCard() {
            emptyDashboardMessage.classList.add('hidden');
            const chartId = `chart-${Date.now()}-${Math.random()}`;
            const card = document.createElement('div');
            card.className = 'chart-card p-4 flex flex-col h-[500px]';

            const allOptions = headers.map(h => `<option value="${h}">${h}</option>`).join('');
            const numericCheckboxes = headers
                .filter(h => columnProfiles[h].type === 'Numeric')
                .map(h => `<label class="flex items-center gap-2 p-1 rounded hover:bg-gray-100"><input type="checkbox" class="y-axis-value h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" value="${h}"> ${h}</label>`)
                .join('');
            
            card.innerHTML = `
                <div class="flex-grow flex flex-col">
                    <input type="text" value="Novo Gráfico" class="text-lg font-bold w-full p-1 mb-2 border-b focus:outline-none focus:border-blue-500">
                    <div class="flex-grow min-h-0"><canvas id="${chartId}"></canvas></div>
                </div>
                <div class="mt-4 pt-3 border-t">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                        <div>
                            <label class="font-semibold block mb-1">Tipo de Gráfico</label>
                            <select class="chart-type w-full p-1.5 border rounded-md bg-gray-50">
                                <option value="bar">Barras</option>
                                <option value="line">Linhas</option>
                                <option value="pie">Pizza</option>
                                <option value="doughnut">Rosca</option>
                                <option value="scatter">Dispersão</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-semibold block mb-1">Eixo X / Legenda</label>
                            <select class="x-axis w-full p-1.5 border rounded-md bg-gray-50">${allOptions}</select>
                        </div>
                        <div class="y-axis-container col-span-1 sm:col-span-2">
                            <label class="font-semibold block mb-1">Eixo Y / Valores</label>
                            <div class="border rounded-md p-2 max-h-28 overflow-y-auto bg-gray-50 space-y-1">
                                <label class="flex items-center gap-2 p-1 rounded hover:bg-gray-100">
                                    <input type="checkbox" class="y-axis-value h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" value="__count__" checked> Contagem
                                </label>
                                ${numericCheckboxes}
                            </div>
                        </div>
                        <div class="col-span-1 sm:col-span-2 mt-2 pt-2 border-t percentage-container">
                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                <input type="checkbox" class="show-percentage-line h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                Mostrar percentual sobre o total (linha)
                            </label>
                        </div>
                    </div>
                </div>
            `;
            chartsGrid.appendChild(card);
            
            const ctx = document.getElementById(chartId).getContext('2d');
            const chartInstance = new Chart(ctx, {});
            charts.push(chartInstance); 

            const typeSelect = card.querySelector('.chart-type');
            const xSelect = card.querySelector('.x-axis');
            const yCheckboxes = card.querySelectorAll('.y-axis-value');
            const titleInput = card.querySelector('input[type="text"]');
            const showPercentageLine = card.querySelector('.show-percentage-line');
            
            function update() {
                const selectedYCols = Array.from(yCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
                updateChart(chartInstance, {
                    type: typeSelect.value,
                    xCol: xSelect.value,
                    yCols: selectedYCols,
                    title: titleInput.value,
                }, showPercentageLine.checked);
            }

            [typeSelect, xSelect, titleInput, showPercentageLine].forEach(el => el.addEventListener('change', update));
            yCheckboxes.forEach(cb => cb.addEventListener('change', update));
            titleInput.addEventListener('input', update);
            
            update(); // Initial render
        }

        function updateChart(chartInstance, config, showPercentage) {
            const { type, xCol, yCols, title } = config;
            
            const datasets = yCols.map((yCol, index) => {
                const isCount = yCol === '__count__';
                const chartData = getChartData(xCol, isCount ? null : yCol, type);
                const color = generateColors(1, index)[0];
                return {
                    label: isCount ? 'Contagem' : yCol,
                    data: chartData.data,
                    backgroundColor: color,
                    borderColor: color.replace('0.6', '1'),
                    borderWidth: type === 'line' ? 2 : 1,
                    yAxisID: 'y',
                };
            });

            const labels = getChartData(xCol, null, type).labels; // Get labels once
            const cardElement = chartInstance.canvas.closest('.chart-card');
            const yAxisContainer = cardElement.querySelector('.y-axis-container');
            const percentageContainer = cardElement.querySelector('.percentage-container');
            const showPercentageCheckbox = percentageContainer.querySelector('input');
            
            const canShowPercentage = ['bar', 'line'].includes(type) && yCols.length === 1 && showPercentage;
            if (canShowPercentage) {
                const total = datasets[0].data.reduce((a, b) => a + (b || 0), 0);
                const percentageData = total > 0 ? datasets[0].data.map(d => ((d || 0) / total) * 100) : [];
                datasets.push({
                    type: 'line', label: 'Percentual', data: percentageData,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    yAxisID: 'yPercentage', fill: false,
                });
            }

            const scales = {
                x: { title: { display: true, text: xCol } },
                y: { beginAtZero: true, position: 'left', title: { display: true, text: yCols.join(', ') } }
            };

            if (canShowPercentage) {
                scales.yPercentage = {
                    beginAtZero: true, type: 'linear', position: 'right', grid: { drawOnChartArea: false },
                    title: { display: true, text: 'Percentual (%)' },
                    ticks: { callback: value => `${value.toFixed(0)}%` },
                };
            }
            
            const isSingleSeries = datasets.length === 1 && !canShowPercentage;
            const isPieType = ['pie', 'doughnut'].includes(type);
            yAxisContainer.style.display = isPieType ? 'none' : 'block';
            percentageContainer.style.display = ['bar', 'line'].includes(type) && yCols.length === 1 ? 'block' : 'none';
            if (!(['bar', 'line'].includes(type) && yCols.length === 1)) {
                showPercentageCheckbox.checked = false;
            }

            chartInstance.data = { labels, datasets };
            chartInstance.config.type = type === 'scatter' ? 'scatter' : (datasets.length > 1 && canShowPercentage ? 'bar' : type);
            chartInstance.options = {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    title: { display: true, text: title, font: { size: 18 } },
                    legend: { display: !isSingleSeries || isPieType, position: isPieType ? 'top' : 'bottom' }
                },
                scales: (type === 'scatter' || type === 'line' || type === 'bar') ? scales : {}
            };
            chartInstance.update();
        }

        function getChartData(xCol, yCol, type) {
            if (type === 'scatter') {
                const data = rawData.map(row => ({ x: parseFloat(row[xCol]), y: parseFloat(row[yCol]) }))
                    .filter(p => !isNaN(p.x) && !isNaN(p.y));
                return { labels: data.map(p => p.x), data };
            }
            const groupedData = rawData.reduce((acc, row) => {
                const key = row[xCol];
                if (key === undefined || key === '') return acc;
                if (!acc[key]) acc[key] = { sum: 0, count: 0 };
                acc[key].count++;
                if (yCol) {
                    const value = parseFloat(row[yCol]);
                    if (!isNaN(value)) acc[key].sum += value;
                }
                return acc;
            }, {});

            const labels = Object.keys(groupedData).sort();
            const data = labels.map(label => !yCol ? groupedData[label].count : (groupedData[label].sum / groupedData[label].count));
            return { labels, data };
        }

        function generateColors(numColors, offset = 0) {
            const colors = [];
            const baseColors = [
                [54, 162, 235], [255, 99, 132], [75, 192, 192],
                [255, 206, 86], [153, 102, 255], [255, 159, 64]
            ];
            for (let i = 0; i < numColors; i++) {
                const color = baseColors[(i + offset) % baseColors.length];
                colors.push(`rgba(${color[0]}, ${color[1]}, ${color[2]}, 0.6)`);
            }
            return colors;
        }

        // --- Event Listeners ---
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(ev => dropZone.addEventListener(ev, e => {e.preventDefault(); e.stopPropagation();}));
        ['dragenter', 'dragover'].forEach(ev => dropZone.addEventListener(ev, () => dropZone.classList.add('border-blue-500', 'bg-blue-50')));
        ['dragleave', 'drop'].forEach(ev => dropZone.addEventListener(ev, () => dropZone.classList.remove('border-blue-500', 'bg-blue-50')));
        dropZone.addEventListener('drop', e => {
            const files = e.dataTransfer.files;
            if (files.length > 0) { fileInput.files = files; handleFile(files[0]); }
        });
        browseButton.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', e => e.target.files.length && handleFile(e.target.files[0]));
        resetButton.addEventListener('click', resetApp);
        addChartButton.addEventListener('click', createChartCard);
    </script>
</body>
</html>

